OPTIONS PRICING & P&L TOOL FOR EXCEL - SETUP INSTRUCTIONS
==========================================================

This tool fetches real-time options prices from Yahoo Finance and calculates
P&L for your option positions at any hypothetical stock price at expiration.


STEP 1: CREATE A NEW MACRO-ENABLED WORKBOOK
-------------------------------------------
1. Open Excel
2. Create a new workbook
3. Save it as a macro-enabled workbook (.xlsm)
   - File > Save As
   - Choose "Excel Macro-Enabled Workbook (*.xlsm)"
   - Name it something like "OptionsPricing.xlsm"


STEP 2: OPEN THE VBA EDITOR
---------------------------
Press Alt + F11 to open the Visual Basic Editor


STEP 3: IMPORT THE VBA MODULES
------------------------------
Method A - Import .bas files:
1. In the VBA Editor, go to File > Import File
2. Navigate to the optionsai folder
3. Import "JsonConverter.bas"
4. Import "OptionsModule.bas"

Method B - Copy/paste code:
1. In the VBA Editor, right-click on "VBAProject (YourWorkbook.xlsm)"
2. Select Insert > Module
3. Copy the contents of JsonConverter.bas and paste into the module
4. Rename the module to "JsonConverter" (in Properties window, bottom left)
5. Insert another module
6. Copy the contents of OptionsModule.bas and paste
7. Rename to "OptionsModule"


STEP 4: SET UP THE WORKSHEET
----------------------------
1. Close the VBA Editor (Alt + Q or click X)
2. Press Alt + F8 to open the Macro dialog
3. Select "SetupSheet" and click Run
   - This will set up your input area and headers


STEP 5: ADD BUTTONS (OPTIONAL BUT RECOMMENDED)
----------------------------------------------
1. Go to Developer tab > Insert > Button (Form Control)
   - If Developer tab is not visible: File > Options > Customize Ribbon > Check "Developer"
2. Draw a button on the sheet
3. Assign macros to buttons:
   - "Get Options" -> FetchOptionsData
   - "Get Expirations" -> FetchExpirationDates
   - "Clear Positions" -> ClearPositions


SHEET LAYOUT
============

INPUT AREA (Rows 1-2):
----------------------
| B           | C                  | D              | F             | H              |
|-------------|--------------------| ---------------|---------------|----------------|
| Ticker      | Expiry (YYYY-MM-DD)| Type (CALL/PUT)| Current Price | Stock @ Expiry |
| AAPL        | 2025-01-17         | CALL           | $185.50       | $190.00        |

- Yellow cells are editable inputs
- "Stock @ Expiry" is where you enter your target price scenario

P&L SUMMARY (Row 3):
--------------------
Shows "Total P&L:" and the sum of all position P&Ls in column L


OPTIONS DATA GRID (Row 5 headers, Row 6+ data):
-----------------------------------------------
| A      | B    | C    | D     | E    | F      | G        | H       | I     | J        | K           | L          | M     |
|--------|------|------|-------|------|--------|----------|---------|-------|----------|-------------|------------|-------|
| Strike | Bid  | Ask  | Last  | Mid  | Volume | Open Int | Impl Vol| Delta | Position | Entry Price | Value@Exp  | P&L   |

MARKET DATA COLUMNS (A-I):
- Strike: Option strike price
- Bid/Ask: Current bid and ask prices
- Last: Last traded price
- Mid: Midpoint of bid/ask (used as default entry price)
- Volume: Contracts traded today
- Open Int: Open interest
- Impl Vol: Implied volatility
- Delta: Option delta (if available from Yahoo)

TRADING COLUMNS (J-M) - highlighted in blue header:
- Position: YOUR INPUT - Number of contracts (+long, -short)
- Entry Price: YOUR INPUT - Price you paid/received (defaults to mid)
- Value@Exp: Calculated option value at expiration
- P&L: Calculated profit/loss for this position


USING THE TOOL
==============

1. LOAD OPTIONS DATA:
   - Enter ticker symbol (e.g., AAPL, MSFT, TSLA)
   - Enter expiration date in YYYY-MM-DD format (or leave blank for nearest)
   - Select CALL or PUT from dropdown
   - Run "FetchOptionsData" macro (or click "Get Options" button)

2. ENTER YOUR POSITIONS:
   - Find the strike(s) you want to trade
   - Enter position in the "Position" column:
     * Positive number = LONG (bought)
     * Negative number = SHORT (sold)
   - Adjust "Entry Price" if different from mid price

3. SET SCENARIO:
   - Enter stock price at expiration in "Stock @ Expiry" cell
   - P&L updates automatically

4. ANALYZE:
   - Individual P&L shows in column M for each position
   - Total P&L shows in row 3, column L
   - Green = profit, Red = loss


EXAMPLE: CALL SPREAD
====================
To analyze a bull call spread (long 180 call, short 190 call):

1. Load AAPL CALL options
2. Find the $180 strike row, enter Position: 1
3. Find the $190 strike row, enter Position: -1
4. Entry prices default to mid (adjust if needed)
5. Enter different "Stock @ Expiry" values to see P&L at various outcomes:
   - Stock @ $175: Both calls expire worthless, lose premium
   - Stock @ $185: Long call worth $5, short call worthless
   - Stock @ $200: Long call worth $20, short call worth -$10 (you owe)


MACROS AVAILABLE
================
- SetupSheet: Initialize the worksheet layout
- FetchOptionsData: Fetch options chain for entered ticker/expiry
- FetchExpirationDates: Show available expiration dates
- ClearPositions: Reset all positions to 0 and clear entry prices
- CalculatePnL: Force recalculation (usually automatic)


P&L CALCULATION
===============
For each position:
  CALL: Value at Expiry = MAX(Stock @ Expiry - Strike, 0)
  PUT:  Value at Expiry = MAX(Strike - Stock @ Expiry, 0)

  P&L = (Value at Expiry - Entry Price) * Position * 100

  * 100 because each contract represents 100 shares


TROUBLESHOOTING
===============

"Failed to fetch data" error:
- Check your internet connection
- Verify the ticker symbol is valid
- Yahoo Finance may be temporarily unavailable

No data appears:
- Make sure the expiration date is a valid options expiration date
- Use "Get Expirations" to see valid dates

Macro security warning:
- Go to File > Options > Trust Center > Trust Center Settings
- Set Macro Settings to "Enable all macros" or "Disable with notification"

"Compile error":
- Make sure both JsonConverter and OptionsModule are imported
- Check that module names match exactly

P&L not updating:
- Make sure "Stock @ Expiry" has a value
- Check that Position column has non-zero values
- Press F9 to force recalculation


NOTES
=====
- Data is from Yahoo Finance and may be delayed 15-20 minutes
- Weekend/after-hours data will show the last trading day's prices
- The tool calculates P&L AT EXPIRATION only (intrinsic value)
- Delta values may not always be available from Yahoo Finance
- Yellow highlighted cells indicate user-editable fields
